<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>File: window.js [RDoc Documentation]</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='file' id='wrapper'>
      <div class='header'>
        <h1 class='name'>window.js</h1>
        <div class='paths'>
          files/javascripts/window.js
        </div>
        <div class='last-update'>
          Last Update:
          <span class='datetime'>Mon Jan 24 10:47:09 -0800 2011</span>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <p>
            // Copyright &#169; 2006 SÃ©bastien Gruhier (<a
            href="http://xilinus.com">xilinus.com</a>, <a
            href="http://itseb.com">itseb.com</a>) // // Permission is hereby granted,
            free of charge, to any person obtaining // a copy of this software and
            associated documentation files (the // &#8220;Software&#8221;), to deal in
            the Software without restriction, including // without limitation the
            rights to use, copy, modify, merge, publish, // distribute, sublicense,
            and/or sell copies of the Software, and to // permit persons to whom the
            Software is furnished to do so, subject to // the following conditions: //
            // The above copyright notice and this permission notice shall be //
            included in all copies or substantial portions of the Software. // // THE
            SOFTWARE IS PROVIDED &#8220;AS IS&#8221;, WITHOUT WARRANTY OF ANY KIND, //
            EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF //
            MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND // NONINFRINGEMENT.
            IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE // LIABLE FOR ANY
            CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION // OF CONTRACT,
            TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION // WITH THE
            SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. // // VERSION 1.3
            </p>
            <p>
            var Window = Class.create();
            </p>
            <p>
            Window.keepMultiModalWindow = false; Window.hasEffectLib = (typeof Effect
            != &#8216;undefined&#8217;); Window.resizeEffectDuration = 0.4;
            </p>
            <p>
            Window.prototype = {
            </p>
            <pre>// Constructor&#x000A;// Available parameters : className, blurClassName, title, minWidth, minHeight, maxWidth, maxHeight, width, height, top, left, bottom, right, resizable, zIndex, opacity, recenterAuto, wiredDrag&#x000A;//                        hideEffect, showEffect, showEffectOptions, hideEffectOptions, effectOptions, url, draggable, closable, minimizable, maximizable, parent, onload&#x000A;//                        add all callbacks (if you do not use an observer)&#x000A;//                        onDestroy onStartResize onStartMove onResize onMove onEndResize onEndMove onFocus onBlur onBeforeShow onShow onHide onMinimize onMaximize onClose&#x000A;&#x000A;initialize: function() {&#x000A;  var id;&#x000A;  var optionIndex = 0;&#x000A;  // For backward compatibility like win= new Window(&quot;id&quot;, {...}) instead of win = new Window({id: &quot;id&quot;, ...})&#x000A;  if (arguments.length &gt; 0) {&#x000A;    if (typeof arguments[0] == &quot;string&quot; ) {&#x000A;      id = arguments[0];&#x000A;      optionIndex = 1;&#x000A;    }&#x000A;    else&#x000A;      id = arguments[0] ? arguments[0].id : null;&#x000A;  }&#x000A;&#x000A;  // Generate unique ID if not specified&#x000A;  if (!id)&#x000A;    id = &quot;window_&quot; + new Date().getTime();&#x000A;&#x000A;  if ($(id))&#x000A;    alert(&quot;Window &quot; + id + &quot; is already registered in the DOM! Make sure you use setDestroyOnClose() or destroyOnClose: true in the constructor&quot;);&#x000A;&#x000A;  this.options = Object.extend({&#x000A;    className:         &quot;dialog&quot;,&#x000A;    blurClassName:     null,&#x000A;    minWidth:          100,&#x000A;    minHeight:         20,&#x000A;    resizable:         true,&#x000A;    closable:          true,&#x000A;    minimizable:       true,&#x000A;    maximizable:       true,&#x000A;    draggable:         true,&#x000A;    userData:          null,&#x000A;    showEffect:        (Window.hasEffectLib ? Effect.Appear : Element.show),&#x000A;    hideEffect:        (Window.hasEffectLib ? Effect.Fade : Element.hide),&#x000A;    showEffectOptions: {},&#x000A;    hideEffectOptions: {},&#x000A;    effectOptions:     null,&#x000A;    parent:            document.body,&#x000A;    title:             &quot;&amp;nbsp;&quot;,&#x000A;    url:               null,&#x000A;    onload:            Prototype.emptyFunction,&#x000A;    width:             200,&#x000A;    height:            300,&#x000A;    opacity:           1,&#x000A;    recenterAuto:      true,&#x000A;    wiredDrag:         false,&#x000A;    closeCallback:     null,&#x000A;    destroyOnClose:    false,&#x000A;    gridX:             1,&#x000A;    gridY:             1&#x000A;  }, arguments[optionIndex] || {});&#x000A;  if (this.options.blurClassName)&#x000A;    this.options.focusClassName = this.options.className;&#x000A;&#x000A;  if (typeof this.options.top == &quot;undefined&quot; &amp;&amp;  typeof this.options.bottom ==  &quot;undefined&quot;)&#x000A;    this.options.top = this._round(Math.random()*500, this.options.gridY);&#x000A;  if (typeof this.options.left == &quot;undefined&quot; &amp;&amp;  typeof this.options.right ==  &quot;undefined&quot;)&#x000A;    this.options.left = this._round(Math.random()*500, this.options.gridX);&#x000A;&#x000A;  if (this.options.effectOptions) {&#x000A;    Object.extend(this.options.hideEffectOptions, this.options.effectOptions);&#x000A;    Object.extend(this.options.showEffectOptions, this.options.effectOptions);&#x000A;    if (this.options.showEffect == Element.Appear)&#x000A;      this.options.showEffectOptions.to = this.options.opacity;&#x000A;  }&#x000A;  if (Window.hasEffectLib) {&#x000A;    if (this.options.showEffect == Effect.Appear)&#x000A;      this.options.showEffectOptions.to = this.options.opacity;&#x000A;&#x000A;    if (this.options.hideEffect == Effect.Fade)&#x000A;      this.options.hideEffectOptions.from = this.options.opacity;&#x000A;  }&#x000A;  if (this.options.hideEffect == Element.hide)&#x000A;    this.options.hideEffect = function(){ Element.hide(this.element); if (this.options.destroyOnClose) this.destroy(); }.bind(this)&#x000A;&#x000A;  if (this.options.parent != document.body)&#x000A;    this.options.parent = $(this.options.parent);&#x000A;&#x000A;  this.element = this._createWindow(id);&#x000A;  this.element.win = this;&#x000A;&#x000A;  // Bind event listener&#x000A;  this.eventMouseDown = this._initDrag.bindAsEventListener(this);&#x000A;  this.eventMouseUp   = this._endDrag.bindAsEventListener(this);&#x000A;  this.eventMouseMove = this._updateDrag.bindAsEventListener(this);&#x000A;  this.eventOnLoad    = this._getWindowBorderSize.bindAsEventListener(this);&#x000A;  this.eventMouseDownContent = this.toFront.bindAsEventListener(this);&#x000A;  this.eventResize = this._recenter.bindAsEventListener(this);&#x000A;&#x000A;  this.topbar = $(this.element.id + &quot;_top&quot;);&#x000A;  this.bottombar = $(this.element.id + &quot;_bottom&quot;);&#x000A;  this.content = $(this.element.id + &quot;_content&quot;);&#x000A;&#x000A;  Event.observe(this.topbar, &quot;mousedown&quot;, this.eventMouseDown);&#x000A;  Event.observe(this.bottombar, &quot;mousedown&quot;, this.eventMouseDown);&#x000A;  Event.observe(this.content, &quot;mousedown&quot;, this.eventMouseDownContent);&#x000A;  Event.observe(window, &quot;load&quot;, this.eventOnLoad);&#x000A;  Event.observe(window, &quot;resize&quot;, this.eventResize);&#x000A;  Event.observe(window, &quot;scroll&quot;, this.eventResize);&#x000A;  Event.observe(this.options.parent, &quot;scroll&quot;, this.eventResize);&#x000A;&#x000A;  if (this.options.draggable)  {&#x000A;    var that = this;&#x000A;    [this.topbar, this.topbar.up().previous(), this.topbar.up().next()].each(function(element) {&#x000A;      element.observe(&quot;mousedown&quot;, that.eventMouseDown);&#x000A;      element.addClassName(&quot;top_draggable&quot;);&#x000A;    });&#x000A;    [this.bottombar.up(), this.bottombar.up().previous(), this.bottombar.up().next()].each(function(element) {&#x000A;      element.observe(&quot;mousedown&quot;, that.eventMouseDown);&#x000A;      element.addClassName(&quot;bottom_draggable&quot;);&#x000A;    });&#x000A;&#x000A;  }&#x000A;&#x000A;  if (this.options.resizable) {&#x000A;    this.sizer = $(this.element.id + &quot;_sizer&quot;);&#x000A;    Event.observe(this.sizer, &quot;mousedown&quot;, this.eventMouseDown);&#x000A;  }&#x000A;&#x000A;  this.useLeft = null;&#x000A;  this.useTop = null;&#x000A;  if (typeof this.options.left != &quot;undefined&quot;) {&#x000A;    this.element.setStyle({left: parseFloat(this.options.left) + 'px'});&#x000A;    this.useLeft = true;&#x000A;  }&#x000A;  else {&#x000A;    this.element.setStyle({right: parseFloat(this.options.right) + 'px'});&#x000A;    this.useLeft = false;&#x000A;  }&#x000A;&#x000A;  if (typeof this.options.top != &quot;undefined&quot;) {&#x000A;    this.element.setStyle({top: parseFloat(this.options.top) + 'px'});&#x000A;    this.useTop = true;&#x000A;  }&#x000A;  else {&#x000A;    this.element.setStyle({bottom: parseFloat(this.options.bottom) + 'px'});&#x000A;    this.useTop = false;&#x000A;  }&#x000A;&#x000A;  this.storedLocation = null;&#x000A;&#x000A;  this.setOpacity(this.options.opacity);&#x000A;  if (this.options.zIndex)&#x000A;    this.setZIndex(this.options.zIndex)&#x000A;&#x000A;  if (this.options.destroyOnClose)&#x000A;    this.setDestroyOnClose(true);&#x000A;&#x000A;  this._getWindowBorderSize();&#x000A;  this.width = this.options.width;&#x000A;  this.height = this.options.height;&#x000A;  this.visible = false;&#x000A;&#x000A;  this.constraint = false;&#x000A;  this.constraintPad = {top: 0, left:0, bottom:0, right:0};&#x000A;&#x000A;  if (this.width &amp;&amp; this.height)&#x000A;    this.setSize(this.options.width, this.options.height);&#x000A;  this.setTitle(this.options.title)&#x000A;  Windows.register(this);&#x000A;},&#x000A;&#x000A;// Destructor&#x000A;destroy: function() {&#x000A;  this._notify(&quot;onDestroy&quot;);&#x000A;  Event.stopObserving(this.topbar, &quot;mousedown&quot;, this.eventMouseDown);&#x000A;  Event.stopObserving(this.bottombar, &quot;mousedown&quot;, this.eventMouseDown);&#x000A;  Event.stopObserving(this.content, &quot;mousedown&quot;, this.eventMouseDownContent);&#x000A;&#x000A;  Event.stopObserving(window, &quot;load&quot;, this.eventOnLoad);&#x000A;  Event.stopObserving(window, &quot;resize&quot;, this.eventResize);&#x000A;  Event.stopObserving(window, &quot;scroll&quot;, this.eventResize);&#x000A;&#x000A;  Event.stopObserving(this.content, &quot;load&quot;, this.options.onload);&#x000A;&#x000A;  if (this._oldParent) {&#x000A;    var content = this.getContent();&#x000A;    var originalContent = null;&#x000A;    for(var i = 0; i &lt; content.childNodes.length; i++) {&#x000A;      originalContent = content.childNodes[i];&#x000A;      if (originalContent.nodeType == 1)&#x000A;        break;&#x000A;      originalContent = null;&#x000A;    }&#x000A;    if (originalContent)&#x000A;      this._oldParent.appendChild(originalContent);&#x000A;    this._oldParent = null;&#x000A;  }&#x000A;&#x000A;  if (this.sizer)&#x000A;      Event.stopObserving(this.sizer, &quot;mousedown&quot;, this.eventMouseDown);&#x000A;&#x000A;  if (this.options.url)&#x000A;    this.content.src = null&#x000A;&#x000A;   if(this.iefix)&#x000A;    Element.remove(this.iefix);&#x000A;&#x000A;  Element.remove(this.element);&#x000A;  Windows.unregister(this);&#x000A;},&#x000A;&#x000A;// Sets close callback, if it sets, it should return true to be able to close the window.&#x000A;setCloseCallback: function(callback) {&#x000A;  this.options.closeCallback = callback;&#x000A;},&#x000A;&#x000A;// Gets window content&#x000A;getContent: function () {&#x000A;  return this.content;&#x000A;},&#x000A;&#x000A;// Sets the content with an element id&#x000A;setContent: function(id, autoresize, autoposition) {&#x000A;  var element = $(id);&#x000A;  if (null == element) throw &quot;Unable to find element '&quot; + id + &quot;' in DOM&quot;;&#x000A;  this._oldParent = element.parentNode;&#x000A;&#x000A;  var d = null;&#x000A;  var p = null;&#x000A;&#x000A;  if (autoresize)&#x000A;    d = Element.getDimensions(element);&#x000A;  if (autoposition)&#x000A;    p = Position.cumulativeOffset(element);&#x000A;&#x000A;  var content = this.getContent();&#x000A;  // Clear HTML (and even iframe)&#x000A;  this.setHTMLContent(&quot;&quot;);&#x000A;  content = this.getContent();&#x000A;&#x000A;  content.appendChild(element);&#x000A;  element.show();&#x000A;  if (autoresize)&#x000A;    this.setSize(d.width, d.height);&#x000A;  if (autoposition)&#x000A;    this.setLocation(p[1] - this.heightN, p[0] - this.widthW);&#x000A;},&#x000A;&#x000A;setHTMLContent: function(html) {&#x000A;  // It was an url (iframe), recreate a div content instead of iframe content&#x000A;  if (this.options.url) {&#x000A;    this.content.src = null;&#x000A;    this.options.url = null;&#x000A;&#x000A;        var content =&quot;&lt;div id=\&quot;&quot; + this.getId() + &quot;_content\&quot; class=\&quot;&quot; + this.options.className + &quot;_content\&quot;&gt; &lt;/div&gt;&quot;;&#x000A;    $(this.getId() +&quot;_table_content&quot;).innerHTML = content;&#x000A;&#x000A;    this.content = $(this.element.id + &quot;_content&quot;);&#x000A;  }&#x000A;  this.getContent().innerHTML = html;&#x000A;},&#x000A;&#x000A;setAjaxContent: function(url, options, showCentered, showModal) {&#x000A;  if(showCentered){&#x000A;    this.showFunction = showCentered ? &quot;showCenter&quot; : &quot;show&quot;;&#x000A;    this.showModal = showModal || false;&#x000A;  } else {&#x000A;    this.showFunction = null;&#x000A;    this.showModal = null;&#x000A;  }&#x000A;&#x000A;  options = options || {};&#x000A;&#x000A;  // Clear HTML (and even iframe)&#x000A;  this.setHTMLContent(&quot;&quot;);&#x000A;&#x000A;  this.onComplete = options.onComplete;&#x000A;  if (! this._onCompleteHandler)&#x000A;    this._onCompleteHandler = this._setAjaxContent.bind(this);&#x000A;  options.onComplete = this._onCompleteHandler;&#x000A;&#x000A;  new Ajax.Request(url, options);&#x000A;  options.onComplete = this.onComplete;&#x000A;},&#x000A;&#x000A;_setAjaxContent: function(originalRequest) {&#x000A;  Element.update(this.getContent(), originalRequest.responseText);&#x000A;  if (this.onComplete)&#x000A;    this.onComplete(originalRequest);&#x000A;  this.onComplete = null;&#x000A;  if(this.showFunction){&#x000A;    this[this.showFunction](this.showModal)&#x000A;  }&#x000A;},&#x000A;&#x000A;setURL: function(url) {&#x000A;  // Not an url content, change div to iframe&#x000A;  if (this.options.url)&#x000A;    this.content.src = null;&#x000A;  this.options.url = url;&#x000A;  var content= &quot;&lt;iframe frameborder='0' name='&quot; + this.getId() + &quot;_content'  id='&quot; + this.getId() + &quot;_content' src='&quot; + url + &quot;' width='&quot; + this.width + &quot;' height='&quot; + this.height + &quot;'&gt; &lt;/iframe&gt;&quot;;&#x000A;  $(this.getId() +&quot;_table_content&quot;).innerHTML = content;&#x000A;&#x000A;  this.content = $(this.element.id + &quot;_content&quot;);&#x000A;},&#x000A;&#x000A;getURL: function() {&#x000A;      return this.options.url ? this.options.url : null;&#x000A;},&#x000A;&#x000A;refresh: function() {&#x000A;  if (this.options.url)&#x000A;          $(this.element.getAttribute('id') + '_content').src = this.options.url;&#x000A;},&#x000A;&#x000A;// Stores position/size in a cookie, by default named with window id&#x000A;setCookie: function(name, expires, path, domain, secure) {&#x000A;  name = name || this.element.id;&#x000A;  this.cookie = [name, expires, path, domain, secure];&#x000A;&#x000A;  // Get cookie&#x000A;  var value = WindowUtilities.getCookie(name)&#x000A;  // If exists&#x000A;  if (value) {&#x000A;    var values = value.split(',');&#x000A;    var x = values[0].split(':');&#x000A;    var y = values[1].split(':');&#x000A;&#x000A;    var w = parseFloat(values[2]), h = parseFloat(values[3]);&#x000A;    var mini = values[4];&#x000A;    var maxi = values[5];&#x000A;&#x000A;    this.setSize(w, h);&#x000A;    if (mini == &quot;true&quot;)&#x000A;      this.doMinimize = true; // Minimize will be done at onload window event&#x000A;    else if (maxi == &quot;true&quot;)&#x000A;      this.doMaximize = true; // Maximize will be done at onload window event&#x000A;&#x000A;    this.useLeft = x[0] == &quot;l&quot;;&#x000A;    this.useTop = y[0] == &quot;t&quot;;&#x000A;&#x000A;    this.element.setStyle(this.useLeft ? {left: x[1]} : {right: x[1]});&#x000A;    this.element.setStyle(this.useTop ? {top: y[1]} : {bottom: y[1]});&#x000A;  }&#x000A;},&#x000A;&#x000A;// Gets window ID&#x000A;getId: function() {&#x000A;  return this.element.id;&#x000A;},&#x000A;&#x000A;// Detroys itself when closing&#x000A;setDestroyOnClose: function() {&#x000A;  this.options.destroyOnClose = true;&#x000A;},&#x000A;&#x000A;setConstraint: function(bool, padding) {&#x000A;  this.constraint = bool;&#x000A;  this.constraintPad = Object.extend(this.constraintPad, padding || {});&#x000A;  // Reset location to apply constraint&#x000A;  if (this.useTop &amp;&amp; this.useLeft)&#x000A;    this.setLocation(parseFloat(this.element.style.top), parseFloat(this.element.style.left));&#x000A;},&#x000A;&#x000A;// initDrag event&#x000A;&#x000A;_initDrag: function(event) {&#x000A;  // No resize on minimized window&#x000A;  if (Event.element(event) == this.sizer &amp;&amp; this.isMinimized())&#x000A;    return;&#x000A;&#x000A;  // No move on maximzed window&#x000A;  if (Event.element(event) != this.sizer &amp;&amp; this.isMaximized())&#x000A;    return;&#x000A;&#x000A;  if (Prototype.Browser.IE &amp;&amp; this.heightN == 0)&#x000A;    this._getWindowBorderSize();&#x000A;&#x000A;  // Get pointer X,Y&#x000A;  this.pointer = [this._round(Event.pointerX(event), this.options.gridX), this._round(Event.pointerY(event), this.options.gridY)];&#x000A;  if (this.options.wiredDrag)&#x000A;    this.currentDrag = this._createWiredElement();&#x000A;  else&#x000A;    this.currentDrag = this.element;&#x000A;&#x000A;  // Resize&#x000A;  if (Event.element(event) == this.sizer) {&#x000A;    this.doResize = true;&#x000A;    this.widthOrg = this.width;&#x000A;    this.heightOrg = this.height;&#x000A;    this.bottomOrg = parseFloat(this.element.getStyle('bottom'));&#x000A;    this.rightOrg = parseFloat(this.element.getStyle('right'));&#x000A;    this._notify(&quot;onStartResize&quot;);&#x000A;  }&#x000A;  else {&#x000A;    this.doResize = false;&#x000A;&#x000A;    // Check if click on close button,&#x000A;    var closeButton = $(this.getId() + '_close');&#x000A;    if (closeButton &amp;&amp; Position.within(closeButton, this.pointer[0], this.pointer[1])) {&#x000A;      this.currentDrag = null;&#x000A;      return;&#x000A;    }&#x000A;&#x000A;    this.toFront();&#x000A;&#x000A;    if (! this.options.draggable)&#x000A;      return;&#x000A;    this._notify(&quot;onStartMove&quot;);&#x000A;  }&#x000A;  // Register global event to capture mouseUp and mouseMove&#x000A;  Event.observe(document, &quot;mouseup&quot;, this.eventMouseUp, false);&#x000A;  Event.observe(document, &quot;mousemove&quot;, this.eventMouseMove, false);&#x000A;&#x000A;  // Add an invisible div to keep catching mouse event over iframes&#x000A;  WindowUtilities.disableScreen('__invisible__', '__invisible__', this.overlayOpacity);&#x000A;&#x000A;  // Stop selection while dragging&#x000A;  document.body.ondrag = function () { return false; };&#x000A;  document.body.onselectstart = function () { return false; };&#x000A;&#x000A;  this.currentDrag.show();&#x000A;  Event.stop(event);&#x000A;},&#x000A;&#x000A;_round: function(val, round) {&#x000A;  return round == 1 ? val  : val = Math.floor(val / round) * round;&#x000A;},&#x000A;&#x000A;// updateDrag event&#x000A;_updateDrag: function(event) {&#x000A;  var pointer =  [this._round(Event.pointerX(event), this.options.gridX), this._round(Event.pointerY(event), this.options.gridY)];&#x000A;  var dx = pointer[0] - this.pointer[0];&#x000A;  var dy = pointer[1] - this.pointer[1];&#x000A;&#x000A;  // Resize case, update width/height&#x000A;  if (this.doResize) {&#x000A;    var w = this.widthOrg + dx;&#x000A;    var h = this.heightOrg + dy;&#x000A;&#x000A;    dx = this.width - this.widthOrg&#x000A;    dy = this.height - this.heightOrg&#x000A;&#x000A;    // Check if it's a right position, update it to keep upper-left corner at the same position&#x000A;    if (this.useLeft)&#x000A;      w = this._updateWidthConstraint(w)&#x000A;    else&#x000A;      this.currentDrag.setStyle({right: (this.rightOrg -dx) + 'px'});&#x000A;    // Check if it's a bottom position, update it to keep upper-left corner at the same position&#x000A;    if (this.useTop)&#x000A;      h = this._updateHeightConstraint(h)&#x000A;    else&#x000A;      this.currentDrag.setStyle({bottom: (this.bottomOrg -dy) + 'px'});&#x000A;&#x000A;    this.setSize(w , h);&#x000A;    this._notify(&quot;onResize&quot;);&#x000A;  }&#x000A;  // Move case, update top/left&#x000A;  else {&#x000A;    this.pointer = pointer;&#x000A;&#x000A;    if (this.useLeft) {&#x000A;      var left =  parseFloat(this.currentDrag.getStyle('left')) + dx;&#x000A;      var newLeft = this._updateLeftConstraint(left);&#x000A;      // Keep mouse pointer correct&#x000A;      this.pointer[0] += newLeft-left;&#x000A;      this.currentDrag.setStyle({left: newLeft + 'px'});&#x000A;    }&#x000A;    else&#x000A;      this.currentDrag.setStyle({right: parseFloat(this.currentDrag.getStyle('right')) - dx + 'px'});&#x000A;&#x000A;    if (this.useTop) {&#x000A;      var top =  parseFloat(this.currentDrag.getStyle('top')) + dy;&#x000A;      var newTop = this._updateTopConstraint(top);&#x000A;      // Keep mouse pointer correct&#x000A;      this.pointer[1] += newTop - top;&#x000A;      this.currentDrag.setStyle({top: newTop + 'px'});&#x000A;    }&#x000A;    else&#x000A;      this.currentDrag.setStyle({bottom: parseFloat(this.currentDrag.getStyle('bottom')) - dy + 'px'});&#x000A;&#x000A;    this._notify(&quot;onMove&quot;);&#x000A;  }&#x000A;  if (this.iefix)&#x000A;    this._fixIEOverlapping();&#x000A;&#x000A;  this._removeStoreLocation();&#x000A;  Event.stop(event);&#x000A;},&#x000A;&#x000A; // endDrag callback&#x000A; _endDrag: function(event) {&#x000A;  // Remove temporary div over iframes&#x000A;   WindowUtilities.enableScreen('__invisible__');&#x000A;&#x000A;  if (this.doResize)&#x000A;    this._notify(&quot;onEndResize&quot;);&#x000A;  else&#x000A;    this._notify(&quot;onEndMove&quot;);&#x000A;&#x000A;  // Release event observing&#x000A;  Event.stopObserving(document, &quot;mouseup&quot;, this.eventMouseUp,false);&#x000A;  Event.stopObserving(document, &quot;mousemove&quot;, this.eventMouseMove, false);&#x000A;&#x000A;  Event.stop(event);&#x000A;&#x000A;  this._hideWiredElement();&#x000A;&#x000A;  // Store new location/size if need be&#x000A;  this._saveCookie()&#x000A;&#x000A;  // Restore selection&#x000A;  document.body.ondrag = null;&#x000A;  document.body.onselectstart = null;&#x000A;},&#x000A;&#x000A;_updateLeftConstraint: function(left) {&#x000A;  if (this.constraint &amp;&amp; this.useLeft &amp;&amp; this.useTop) {&#x000A;    var width = this.options.parent == document.body ? WindowUtilities.getPageSize().windowWidth : this.options.parent.getDimensions().width;&#x000A;&#x000A;    // the -10 gives a bit of pad to reduce window from jumping screen&#x000A;    if (left &lt; this.constraintPad.left)&#x000A;      left = this.constraintPad.left - 10;&#x000A;    if (left + this.width + this.widthE + this.widthW &gt; width - this.constraintPad.right)&#x000A;      left = width - this.constraintPad.right - this.width - this.widthE - this.widthW;&#x000A;  }&#x000A;  return left;&#x000A;},&#x000A;&#x000A;_updateTopConstraint: function(top) {&#x000A;  if (this.constraint &amp;&amp; this.useLeft &amp;&amp; this.useTop) {&#x000A;    var height = this.options.parent == document.body ? WindowUtilities.getPageSize().windowHeight : this.options.parent.getDimensions().height;&#x000A;&#x000A;    var h = this.height + this.heightN + this.heightS;&#x000A;&#x000A;    if (top &lt; this.constraintPad.top)&#x000A;      top = this.constraintPad.top;&#x000A;    if (top + h &gt; height - this.constraintPad.bottom)&#x000A;      top = height - this.constraintPad.bottom - h;&#x000A;  }&#x000A;  return top;&#x000A;},&#x000A;&#x000A;_updateWidthConstraint: function(w) {&#x000A;  if (this.constraint &amp;&amp; this.useLeft &amp;&amp; this.useTop) {&#x000A;    var width = this.options.parent == document.body ? WindowUtilities.getPageSize().windowWidth : this.options.parent.getDimensions().width;&#x000A;    var left =  parseFloat(this.element.getStyle(&quot;left&quot;));&#x000A;&#x000A;    if (left + w + this.widthE + this.widthW &gt; width - this.constraintPad.right)&#x000A;      w = width - this.constraintPad.right - left - this.widthE - this.widthW;&#x000A;  }&#x000A;  return w;&#x000A;},&#x000A;&#x000A;_updateHeightConstraint: function(h) {&#x000A;  if (this.constraint &amp;&amp; this.useLeft &amp;&amp; this.useTop) {&#x000A;    var height = this.options.parent == document.body ? WindowUtilities.getPageSize().windowHeight : this.options.parent.getDimensions().height;&#x000A;    var top =  parseFloat(this.element.getStyle(&quot;top&quot;));&#x000A;&#x000A;    if (top + h + this.heightN + this.heightS &gt; height - this.constraintPad.bottom)&#x000A;      h = height - this.constraintPad.bottom - top - this.heightN - this.heightS;&#x000A;  }&#x000A;  return h;&#x000A;},&#x000A;&#x000A;// Creates HTML window code&#x000A;_createWindow: function(id) {&#x000A;  var className = this.options.className;&#x000A;  var win = document.createElement(&quot;div&quot;);&#x000A;  win.setAttribute('id', id);&#x000A;  win.className = &quot;dialog&quot;;&#x000A;&#x000A;  var content;&#x000A;  if (this.options.url)&#x000A;    content= &quot;&lt;iframe frameborder=\&quot;0\&quot; name=\&quot;&quot; + id + &quot;_content\&quot;  id=\&quot;&quot; + id + &quot;_content\&quot; src=\&quot;&quot; + this.options.url + &quot;\&quot;&gt; &lt;/iframe&gt;&quot;;&#x000A;  else&#x000A;    content =&quot;&lt;div id=\&quot;&quot; + id + &quot;_content\&quot; class=\&quot;&quot; +className + &quot;_content\&quot;&gt; &lt;/div&gt;&quot;;&#x000A;&#x000A;  var closeDiv = this.options.closable ? &quot;&lt;div class='&quot;+ className +&quot;_close' id='&quot;+ id +&quot;_close' onclick='Windows.close(\&quot;&quot;+ id +&quot;\&quot;, event)'&gt; &lt;/div&gt;&quot; : &quot;&quot;;&#x000A;  var minDiv = this.options.minimizable ? &quot;&lt;div class='&quot;+ className + &quot;_minimize' id='&quot;+ id +&quot;_minimize' onclick='Windows.minimize(\&quot;&quot;+ id +&quot;\&quot;, event)'&gt; &lt;/div&gt;&quot; : &quot;&quot;;&#x000A;  var maxDiv = this.options.maximizable ? &quot;&lt;div class='&quot;+ className + &quot;_maximize' id='&quot;+ id +&quot;_maximize' onclick='Windows.maximize(\&quot;&quot;+ id +&quot;\&quot;, event)'&gt; &lt;/div&gt;&quot; : &quot;&quot;;&#x000A;  var seAttributes = this.options.resizable ? &quot;class='&quot; + className + &quot;_sizer' id='&quot; + id + &quot;_sizer'&quot; : &quot;class='&quot;  + className + &quot;_se'&quot;;&#x000A;  var blank = &quot;../themes/default/blank.gif&quot;;&#x000A;&#x000A;  win.innerHTML = closeDiv + minDiv + maxDiv + &quot;\&#x000A;    &lt;table id='&quot;+ id +&quot;_row1' class=\&quot;top table_window\&quot;&gt;\&#x000A;      &lt;tr&gt;\&#x000A;        &lt;td class='&quot;+ className +&quot;_nw'&gt;&lt;/td&gt;\&#x000A;        &lt;td class='&quot;+ className +&quot;_n'&gt;&lt;div id='&quot;+ id +&quot;_top' class='&quot;+ className +&quot;_title title_window'&gt;&quot;+ this.options.title +&quot;&lt;/div&gt;&lt;/td&gt;\&#x000A;        &lt;td class='&quot;+ className +&quot;_ne'&gt;&lt;/td&gt;\&#x000A;      &lt;/tr&gt;\&#x000A;    &lt;/table&gt;\&#x000A;    &lt;table id='&quot;+ id +&quot;_row2' class=\&quot;mid table_window\&quot;&gt;\&#x000A;      &lt;tr&gt;\&#x000A;        &lt;td class='&quot;+ className +&quot;_w'&gt;&lt;/td&gt;\&#x000A;          &lt;td id='&quot;+ id +&quot;_table_content' class='&quot;+ className +&quot;_content' valign='top'&gt;&quot; + content + &quot;&lt;/td&gt;\&#x000A;        &lt;td class='&quot;+ className +&quot;_e'&gt;&lt;/td&gt;\&#x000A;      &lt;/tr&gt;\&#x000A;    &lt;/table&gt;\&#x000A;      &lt;table id='&quot;+ id +&quot;_row3' class=\&quot;bot table_window\&quot;&gt;\&#x000A;      &lt;tr&gt;\&#x000A;        &lt;td class='&quot;+ className +&quot;_sw'&gt;&lt;/td&gt;\&#x000A;          &lt;td class='&quot;+ className +&quot;_s'&gt;&lt;div id='&quot;+ id +&quot;_bottom' class='status_bar'&gt;&lt;span style='float:left; width:1px; height:1px'&gt;&lt;/span&gt;&lt;/div&gt;&lt;/td&gt;\&#x000A;          &lt;td &quot; + seAttributes + &quot;&gt;&lt;/td&gt;\&#x000A;      &lt;/tr&gt;\&#x000A;    &lt;/table&gt;\&#x000A;  &quot;;&#x000A;  Element.hide(win);&#x000A;  this.options.parent.insertBefore(win, this.options.parent.firstChild);&#x000A;  Event.observe($(id + &quot;_content&quot;), &quot;load&quot;, this.options.onload);&#x000A;  return win;&#x000A;},&#x000A;&#x000A;changeClassName: function(newClassName) {&#x000A;  var className = this.options.className;&#x000A;  var id = this.getId();&#x000A;  $A([&quot;_close&quot;, &quot;_minimize&quot;, &quot;_maximize&quot;, &quot;_sizer&quot;, &quot;_content&quot;]).each(function(value) { this._toggleClassName($(id + value), className + value, newClassName + value) }.bind(this));&#x000A;  this._toggleClassName($(id + &quot;_top&quot;), className + &quot;_title&quot;, newClassName + &quot;_title&quot;);&#x000A;  $$(&quot;#&quot; + id + &quot; td&quot;).each(function(td) {td.className = td.className.sub(className,newClassName); });&#x000A;  this.options.className = newClassName;&#x000A;},&#x000A;&#x000A;_toggleClassName: function(element, oldClassName, newClassName) {&#x000A;  if (element) {&#x000A;    element.removeClassName(oldClassName);&#x000A;    element.addClassName(newClassName);&#x000A;  }&#x000A;},&#x000A;&#x000A;// Sets window location&#x000A;setLocation: function(top, left) {&#x000A;  top = this._updateTopConstraint(top);&#x000A;  left = this._updateLeftConstraint(left);&#x000A;&#x000A;  var e = this.currentDrag || this.element;&#x000A;  e.setStyle({top: top + 'px'});&#x000A;  e.setStyle({left: left + 'px'});&#x000A;&#x000A;  this.useLeft = true;&#x000A;  this.useTop = true;&#x000A;},&#x000A;&#x000A;getLocation: function() {&#x000A;  var location = {};&#x000A;  if (this.useTop)&#x000A;    location = Object.extend(location, {top: this.element.getStyle(&quot;top&quot;)});&#x000A;  else&#x000A;    location = Object.extend(location, {bottom: this.element.getStyle(&quot;bottom&quot;)});&#x000A;  if (this.useLeft)&#x000A;    location = Object.extend(location, {left: this.element.getStyle(&quot;left&quot;)});&#x000A;  else&#x000A;    location = Object.extend(location, {right: this.element.getStyle(&quot;right&quot;)});&#x000A;&#x000A;  return location;&#x000A;},&#x000A;&#x000A;// Gets window size&#x000A;getSize: function() {&#x000A;  return {width: this.width, height: this.height};&#x000A;},&#x000A;&#x000A;// Sets window size&#x000A;setSize: function(width, height, useEffect) {&#x000A;  width = parseFloat(width);&#x000A;  height = parseFloat(height);&#x000A;&#x000A;  // Check min and max size&#x000A;  if (!this.minimized &amp;&amp; width &lt; this.options.minWidth)&#x000A;    width = this.options.minWidth;&#x000A;&#x000A;  if (!this.minimized &amp;&amp; height &lt; this.options.minHeight)&#x000A;    height = this.options.minHeight;&#x000A;&#x000A;  if (this.options. maxHeight &amp;&amp; height &gt; this.options. maxHeight)&#x000A;    height = this.options. maxHeight;&#x000A;&#x000A;  if (this.options. maxWidth &amp;&amp; width &gt; this.options. maxWidth)&#x000A;    width = this.options. maxWidth;&#x000A;&#x000A;  if (this.useTop &amp;&amp; this.useLeft &amp;&amp; Window.hasEffectLib &amp;&amp; Effect.ResizeWindow &amp;&amp; useEffect) {&#x000A;    new Effect.ResizeWindow(this, null, null, width, height, {duration: Window.resizeEffectDuration});&#x000A;  } else {&#x000A;    this.width = width;&#x000A;    this.height = height;&#x000A;    var e = this.currentDrag ? this.currentDrag : this.element;&#x000A;&#x000A;    e.setStyle({width: width + this.widthW + this.widthE + &quot;px&quot;})&#x000A;    e.setStyle({height: height  + this.heightN + this.heightS + &quot;px&quot;})&#x000A;&#x000A;    // Update content size&#x000A;    if (!this.currentDrag || this.currentDrag == this.element) {&#x000A;      var content = $(this.element.id + '_content');&#x000A;      content.setStyle({height: height  + 'px'});&#x000A;      content.setStyle({width: width  + 'px'});&#x000A;    }&#x000A;  }&#x000A;},&#x000A;&#x000A;updateHeight: function() {&#x000A;  this.setSize(this.width, this.content.scrollHeight, true);&#x000A;},&#x000A;&#x000A;updateWidth: function() {&#x000A;  this.setSize(this.content.scrollWidth, this.height, true);&#x000A;},&#x000A;&#x000A;// Brings window to front&#x000A;toFront: function() {&#x000A;  if (this.element.style.zIndex &lt; Windows.maxZIndex)&#x000A;    this.setZIndex(Windows.maxZIndex + 1);&#x000A;  if (this.iefix)&#x000A;    this._fixIEOverlapping();&#x000A;},&#x000A;&#x000A;getBounds: function(insideOnly) {&#x000A;  if (! this.width || !this.height || !this.visible)&#x000A;    this.computeBounds();&#x000A;  var w = this.width;&#x000A;  var h = this.height;&#x000A;&#x000A;  if (!insideOnly) {&#x000A;    w += this.widthW + this.widthE;&#x000A;    h += this.heightN + this.heightS;&#x000A;  }&#x000A;  var bounds = Object.extend(this.getLocation(), {width: w + &quot;px&quot;, height: h + &quot;px&quot;});&#x000A;  return bounds;&#x000A;},&#x000A;&#x000A;computeBounds: function() {&#x000A;   if (! this.width || !this.height) {&#x000A;    var size = WindowUtilities._computeSize(this.content.innerHTML, this.content.id, this.width, this.height, 0, this.options.className)&#x000A;    if (this.height)&#x000A;      this.width = size + 5&#x000A;    else&#x000A;      this.height = size + 5&#x000A;  }&#x000A;&#x000A;  this.setSize(this.width, this.height);&#x000A;  if (this.centered)&#x000A;    this._center(this.centerTop, this.centerLeft);&#x000A;},&#x000A;&#x000A;// Displays window modal state or not&#x000A;show: function(modal) {&#x000A;  this.visible = true;&#x000A;  if (modal) {&#x000A;    // Hack for Safari !!&#x000A;    if (typeof this.overlayOpacity == &quot;undefined&quot;) {&#x000A;      var that = this;&#x000A;      setTimeout(function() {that.show(modal)}, 10);&#x000A;      return;&#x000A;    }&#x000A;    Windows.addModalWindow(this);&#x000A;&#x000A;    this.modal = true;&#x000A;    this.setZIndex(Windows.maxZIndex + 1);&#x000A;    Windows.unsetOverflow(this);&#x000A;  }&#x000A;  else&#x000A;    if (!this.element.style.zIndex)&#x000A;      this.setZIndex(Windows.maxZIndex + 1);&#x000A;&#x000A;  // To restore overflow if need be&#x000A;  if (this.oldStyle)&#x000A;    this.getContent().setStyle({overflow: this.oldStyle});&#x000A;&#x000A;  this.computeBounds();&#x000A;&#x000A;  this._notify(&quot;onBeforeShow&quot;);&#x000A;  if (this.options.showEffect != Element.show &amp;&amp; this.options.showEffectOptions)&#x000A;    this.options.showEffect(this.element, this.options.showEffectOptions);&#x000A;  else&#x000A;    this.options.showEffect(this.element);&#x000A;&#x000A;  this._checkIEOverlapping();&#x000A;  WindowUtilities.focusedWindow = this;</pre>
            <p>
            // this.getContent().style.display = &#8216;none&#8217;;
            </p>
            <pre>  this.getContent().style.scroll = 'auto';&#x000A;  this._notify(&quot;onShow&quot;);&#x000A;},&#x000A;&#x000A;// Displays window modal state or not at the center of the page&#x000A;showCenter: function(modal, top, left) {&#x000A;  this.centered = true;&#x000A;  this.centerTop = top;&#x000A;  this.centerLeft = left;&#x000A;&#x000A;  this.show(modal);&#x000A;},&#x000A;&#x000A;isVisible: function() {&#x000A;  return this.visible;&#x000A;},&#x000A;&#x000A;_center: function(top, left) {&#x000A;  var windowScroll = WindowUtilities.getWindowScroll(this.options.parent);&#x000A;  var pageSize = WindowUtilities.getPageSize(this.options.parent);&#x000A;  if (typeof top == &quot;undefined&quot;)&#x000A;    top = (pageSize.windowHeight - (this.height + this.heightN + this.heightS))/2;&#x000A;  top += windowScroll.top&#x000A;&#x000A;  if (typeof left == &quot;undefined&quot;)&#x000A;    left = (pageSize.windowWidth - (this.width + this.widthW + this.widthE))/2;&#x000A;  left += windowScroll.left&#x000A;  this.setLocation(top, left);&#x000A;  this.toFront();&#x000A;},&#x000A;&#x000A;_recenter: function(event) {&#x000A;  if (this.centered) {&#x000A;    var pageSize = WindowUtilities.getPageSize(this.options.parent);&#x000A;    var windowScroll = WindowUtilities.getWindowScroll(this.options.parent);&#x000A;&#x000A;    // Check for this stupid IE that sends dumb events&#x000A;    if (this.pageSize &amp;&amp; this.pageSize.windowWidth == pageSize.windowWidth &amp;&amp; this.pageSize.windowHeight == pageSize.windowHeight &amp;&amp;&#x000A;        this.windowScroll.left == windowScroll.left &amp;&amp; this.windowScroll.top == windowScroll.top)&#x000A;      return;&#x000A;    this.pageSize = pageSize;&#x000A;    this.windowScroll = windowScroll;&#x000A;    // set height of Overlay to take up whole page and show&#x000A;    if ($('overlay_modal'))&#x000A;      $('overlay_modal').setStyle({height: (pageSize.pageHeight + 'px')});&#x000A;&#x000A;    if (this.options.recenterAuto)&#x000A;      this._center(this.centerTop, this.centerLeft);&#x000A;  }&#x000A;},&#x000A;&#x000A;// Hides window&#x000A;hide: function() {&#x000A;  this.visible = false;&#x000A;  if (this.modal) {&#x000A;    Windows.removeModalWindow(this);&#x000A;    Windows.resetOverflow();&#x000A;  }&#x000A;  // To avoid bug on scrolling bar&#x000A;  this.oldStyle = this.getContent().getStyle('overflow') || &quot;auto&quot;&#x000A;  this.getContent().setStyle({overflow: &quot;hidden&quot;});&#x000A;&#x000A;  this.options.hideEffect(this.element, this.options.hideEffectOptions);&#x000A;&#x000A;   if(this.iefix)&#x000A;    this.iefix.hide();&#x000A;&#x000A;  if (!this.doNotNotifyHide)&#x000A;    this._notify(&quot;onHide&quot;);&#x000A;},&#x000A;&#x000A;close: function() {&#x000A;  // Asks closeCallback if exists&#x000A;  if (this.visible) {&#x000A;    if (this.options.closeCallback &amp;&amp; ! this.options.closeCallback(this))&#x000A;      return;&#x000A;&#x000A;    if (this.options.destroyOnClose) {&#x000A;      var destroyFunc = this.destroy.bind(this);&#x000A;      if (this.options.hideEffectOptions.afterFinish) {&#x000A;        var func = this.options.hideEffectOptions.afterFinish;&#x000A;        this.options.hideEffectOptions.afterFinish = function() {func();destroyFunc() }&#x000A;      }&#x000A;      else&#x000A;        this.options.hideEffectOptions.afterFinish = function() {destroyFunc() }&#x000A;    }&#x000A;    Windows.updateFocusedWindow();&#x000A;&#x000A;    this.doNotNotifyHide = true;&#x000A;    this.hide();&#x000A;    this.doNotNotifyHide = false;&#x000A;    this._notify(&quot;onClose&quot;);&#x000A;  }&#x000A;},&#x000A;&#x000A;minimize: function() {&#x000A;  if (this.resizing)&#x000A;    return;&#x000A;&#x000A;  var r2 = $(this.getId() + &quot;_row2&quot;);&#x000A;&#x000A;  if (!this.minimized) {&#x000A;    this.minimized = true;&#x000A;&#x000A;    var dh = r2.getDimensions().height;&#x000A;    this.r2Height = dh;&#x000A;    var h  = this.element.getHeight() - dh;&#x000A;&#x000A;    if (this.useLeft &amp;&amp; this.useTop &amp;&amp; Window.hasEffectLib &amp;&amp; Effect.ResizeWindow) {&#x000A;      new Effect.ResizeWindow(this, null, null, null, this.height -dh, {duration: Window.resizeEffectDuration});&#x000A;    } else  {&#x000A;      this.height -= dh;&#x000A;      this.element.setStyle({height: h + &quot;px&quot;});&#x000A;      r2.hide();&#x000A;    }&#x000A;&#x000A;    if (! this.useTop) {&#x000A;      var bottom = parseFloat(this.element.getStyle('bottom'));&#x000A;      this.element.setStyle({bottom: (bottom + dh) + 'px'});&#x000A;    }&#x000A;  }&#x000A;  else {&#x000A;    this.minimized = false;&#x000A;&#x000A;    var dh = this.r2Height;&#x000A;    this.r2Height = null;&#x000A;    if (this.useLeft &amp;&amp; this.useTop &amp;&amp; Window.hasEffectLib &amp;&amp; Effect.ResizeWindow) {&#x000A;      new Effect.ResizeWindow(this, null, null, null, this.height + dh, {duration: Window.resizeEffectDuration});&#x000A;    }&#x000A;    else {&#x000A;      var h  = this.element.getHeight() + dh;&#x000A;      this.height += dh;&#x000A;      this.element.setStyle({height: h + &quot;px&quot;})&#x000A;      r2.show();&#x000A;    }&#x000A;    if (! this.useTop) {&#x000A;      var bottom = parseFloat(this.element.getStyle('bottom'));&#x000A;      this.element.setStyle({bottom: (bottom - dh) + 'px'});&#x000A;    }&#x000A;    this.toFront();&#x000A;  }&#x000A;  this._notify(&quot;onMinimize&quot;);&#x000A;&#x000A;  // Store new location/size if need be&#x000A;  this._saveCookie()&#x000A;},&#x000A;&#x000A;maximize: function() {&#x000A;  if (this.isMinimized() || this.resizing)&#x000A;    return;&#x000A;&#x000A;  if (Prototype.Browser.IE &amp;&amp; this.heightN == 0)&#x000A;    this._getWindowBorderSize();&#x000A;&#x000A;  if (this.storedLocation != null) {&#x000A;    this._restoreLocation();&#x000A;    if(this.iefix)&#x000A;      this.iefix.hide();&#x000A;  }&#x000A;  else {&#x000A;    this._storeLocation();&#x000A;    Windows.unsetOverflow(this);&#x000A;&#x000A;    var windowScroll = WindowUtilities.getWindowScroll(this.options.parent);&#x000A;    var pageSize = WindowUtilities.getPageSize(this.options.parent);&#x000A;    var left = windowScroll.left;&#x000A;    var top = windowScroll.top;&#x000A;&#x000A;    if (this.options.parent != document.body) {&#x000A;      windowScroll =  {top:0, left:0, bottom:0, right:0};&#x000A;      var dim = this.options.parent.getDimensions();&#x000A;      pageSize.windowWidth = dim.width;&#x000A;      pageSize.windowHeight = dim.height;&#x000A;      top = 0;&#x000A;      left = 0;&#x000A;    }&#x000A;&#x000A;    if (this.constraint) {&#x000A;      pageSize.windowWidth -= Math.max(0, this.constraintPad.left) + Math.max(0, this.constraintPad.right);&#x000A;      pageSize.windowHeight -= Math.max(0, this.constraintPad.top) + Math.max(0, this.constraintPad.bottom);&#x000A;      left +=  Math.max(0, this.constraintPad.left);&#x000A;      top +=  Math.max(0, this.constraintPad.top);&#x000A;    }&#x000A;&#x000A;    var width = pageSize.windowWidth - this.widthW - this.widthE;&#x000A;    var height= pageSize.windowHeight - this.heightN - this.heightS;&#x000A;&#x000A;    if (this.useLeft &amp;&amp; this.useTop &amp;&amp; Window.hasEffectLib &amp;&amp; Effect.ResizeWindow) {&#x000A;      new Effect.ResizeWindow(this, top, left, width, height, {duration: Window.resizeEffectDuration});&#x000A;    }&#x000A;    else {&#x000A;      this.setSize(width, height);&#x000A;      this.element.setStyle(this.useLeft ? {left: left} : {right: left});&#x000A;      this.element.setStyle(this.useTop ? {top: top} : {bottom: top});&#x000A;    }&#x000A;&#x000A;    this.toFront();&#x000A;    if (this.iefix)&#x000A;      this._fixIEOverlapping();&#x000A;  }&#x000A;  this._notify(&quot;onMaximize&quot;);&#x000A;&#x000A;  // Store new location/size if need be&#x000A;  this._saveCookie()&#x000A;},&#x000A;&#x000A;isMinimized: function() {&#x000A;  return this.minimized;&#x000A;},&#x000A;&#x000A;isMaximized: function() {&#x000A;  return (this.storedLocation != null);&#x000A;},&#x000A;&#x000A;setOpacity: function(opacity) {&#x000A;  if (Element.setOpacity)&#x000A;    Element.setOpacity(this.element, opacity);&#x000A;},&#x000A;&#x000A;setZIndex: function(zindex) {&#x000A;  this.element.setStyle({zIndex: zindex});&#x000A;  Windows.updateZindex(zindex, this);&#x000A;},&#x000A;&#x000A;setTitle: function(newTitle) {&#x000A;  if (!newTitle || newTitle == &quot;&quot;)&#x000A;    newTitle = &quot;&amp;nbsp;&quot;;&#x000A;&#x000A;  Element.update(this.element.id + '_top', newTitle);&#x000A;},&#x000A;&#x000A;getTitle: function() {&#x000A;  return $(this.element.id + '_top').innerHTML;&#x000A;},&#x000A;&#x000A;setStatusBar: function(element) {&#x000A;  var statusBar = $(this.getId() + &quot;_bottom&quot;);&#x000A;&#x000A;  if (typeof(element) == &quot;object&quot;) {&#x000A;    if (this.bottombar.firstChild)&#x000A;      this.bottombar.replaceChild(element, this.bottombar.firstChild);&#x000A;    else&#x000A;      this.bottombar.appendChild(element);&#x000A;  }&#x000A;  else&#x000A;    this.bottombar.innerHTML = element;&#x000A;},&#x000A;&#x000A;_checkIEOverlapping: function() {&#x000A;  if(!this.iefix &amp;&amp; (navigator.appVersion.indexOf('MSIE')&gt;0) &amp;&amp; (navigator.userAgent.indexOf('Opera')&lt;0) &amp;&amp; (this.element.getStyle('position')=='absolute')) {&#x000A;      new Insertion.After(this.element.id, '&lt;iframe id=&quot;' + this.element.id + '_iefix&quot; '+ 'style=&quot;display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);&quot; ' + 'src=&quot;javascript:false;&quot; frameborder=&quot;0&quot; scrolling=&quot;no&quot;&gt;&lt;/iframe&gt;');&#x000A;      this.iefix = $(this.element.id+'_iefix');&#x000A;  }&#x000A;  if(this.iefix)&#x000A;    setTimeout(this._fixIEOverlapping.bind(this), 50);&#x000A;},&#x000A;&#x000A;_fixIEOverlapping: function() {&#x000A;    Position.clone(this.element, this.iefix);&#x000A;    this.iefix.style.zIndex = this.element.style.zIndex - 1;&#x000A;    this.iefix.show();&#x000A;},&#x000A;&#x000A;_getWindowBorderSize: function(event) {&#x000A;  // Hack to get real window border size!!&#x000A;  var div = this._createHiddenDiv(this.options.className + &quot;_n&quot;)&#x000A;  this.heightN = Element.getDimensions(div).height;&#x000A;  div.parentNode.removeChild(div)&#x000A;&#x000A;  var div = this._createHiddenDiv(this.options.className + &quot;_s&quot;)&#x000A;  this.heightS = Element.getDimensions(div).height;&#x000A;  div.parentNode.removeChild(div)&#x000A;&#x000A;  var div = this._createHiddenDiv(this.options.className + &quot;_e&quot;)&#x000A;  this.widthE = Element.getDimensions(div).width;&#x000A;  div.parentNode.removeChild(div)&#x000A;&#x000A;  var div = this._createHiddenDiv(this.options.className + &quot;_w&quot;)&#x000A;  this.widthW = Element.getDimensions(div).width;&#x000A;  div.parentNode.removeChild(div);&#x000A;&#x000A;  var div = document.createElement(&quot;div&quot;);&#x000A;  div.className = &quot;overlay_&quot; + this.options.className ;&#x000A;  document.body.appendChild(div);&#x000A;  //alert(&quot;no timeout:\nopacity: &quot; + div.getStyle(&quot;opacity&quot;) + &quot;\nwidth: &quot; + document.defaultView.getComputedStyle(div, null).width);&#x000A;  var that = this;&#x000A;&#x000A;  // Workaround for Safari!!&#x000A;  setTimeout(function() {that.overlayOpacity = ($(div).getStyle(&quot;opacity&quot;)); div.parentNode.removeChild(div);}, 10);&#x000A;&#x000A;  // Workaround for IE!!&#x000A;  if (Prototype.Browser.IE) {&#x000A;    this.heightS = $(this.getId() +&quot;_row3&quot;).getDimensions().height;&#x000A;    this.heightN = $(this.getId() +&quot;_row1&quot;).getDimensions().height;&#x000A;  }&#x000A;&#x000A;  // Safari size fix&#x000A;  if (Prototype.Browser.WebKit &amp;&amp; Prototype.Browser.WebKitVersion &lt; 420)&#x000A;    this.setSize(this.width, this.height);&#x000A;  if (this.doMaximize)&#x000A;    this.maximize();&#x000A;  if (this.doMinimize)&#x000A;    this.minimize();&#x000A;},&#x000A;&#x000A;_createHiddenDiv: function(className) {&#x000A;  var objBody = document.body;&#x000A;  var win = document.createElement(&quot;div&quot;);&#x000A;  win.setAttribute('id', this.element.id+ &quot;_tmp&quot;);&#x000A;  win.className = className;&#x000A;  win.style.display = 'none';&#x000A;  win.innerHTML = '';&#x000A;  objBody.insertBefore(win, objBody.firstChild);&#x000A;  return win;&#x000A;},&#x000A;&#x000A;_storeLocation: function() {&#x000A;  if (this.storedLocation == null) {&#x000A;    this.storedLocation = {useTop: this.useTop, useLeft: this.useLeft,&#x000A;                           top: this.element.getStyle('top'), bottom: this.element.getStyle('bottom'),&#x000A;                           left: this.element.getStyle('left'), right: this.element.getStyle('right'),&#x000A;                           width: this.width, height: this.height };&#x000A;  }&#x000A;},&#x000A;&#x000A;_restoreLocation: function() {&#x000A;  if (this.storedLocation != null) {&#x000A;    this.useLeft = this.storedLocation.useLeft;&#x000A;    this.useTop = this.storedLocation.useTop;&#x000A;&#x000A;    if (this.useLeft &amp;&amp; this.useTop &amp;&amp; Window.hasEffectLib &amp;&amp; Effect.ResizeWindow)&#x000A;      new Effect.ResizeWindow(this, this.storedLocation.top, this.storedLocation.left, this.storedLocation.width, this.storedLocation.height, {duration: Window.resizeEffectDuration});&#x000A;    else {&#x000A;      this.element.setStyle(this.useLeft ? {left: this.storedLocation.left} : {right: this.storedLocation.right});&#x000A;      this.element.setStyle(this.useTop ? {top: this.storedLocation.top} : {bottom: this.storedLocation.bottom});&#x000A;      this.setSize(this.storedLocation.width, this.storedLocation.height);&#x000A;    }&#x000A;&#x000A;    Windows.resetOverflow();&#x000A;    this._removeStoreLocation();&#x000A;  }&#x000A;},&#x000A;&#x000A;_removeStoreLocation: function() {&#x000A;  this.storedLocation = null;&#x000A;},&#x000A;&#x000A;_saveCookie: function() {&#x000A;  if (this.cookie) {&#x000A;    var value = &quot;&quot;;&#x000A;    if (this.useLeft)&#x000A;      value += &quot;l:&quot; +  (this.storedLocation ? this.storedLocation.left : this.element.getStyle('left'))&#x000A;    else&#x000A;      value += &quot;r:&quot; + (this.storedLocation ? this.storedLocation.right : this.element.getStyle('right'))&#x000A;    if (this.useTop)&#x000A;      value += &quot;,t:&quot; + (this.storedLocation ? this.storedLocation.top : this.element.getStyle('top'))&#x000A;    else&#x000A;      value += &quot;,b:&quot; + (this.storedLocation ? this.storedLocation.bottom :this.element.getStyle('bottom'))&#x000A;&#x000A;    value += &quot;,&quot; + (this.storedLocation ? this.storedLocation.width : this.width);&#x000A;    value += &quot;,&quot; + (this.storedLocation ? this.storedLocation.height : this.height);&#x000A;    value += &quot;,&quot; + this.isMinimized();&#x000A;    value += &quot;,&quot; + this.isMaximized();&#x000A;    WindowUtilities.setCookie(value, this.cookie)&#x000A;  }&#x000A;},&#x000A;&#x000A;_createWiredElement: function() {&#x000A;  if (! this.wiredElement) {&#x000A;    if (Prototype.Browser.IE)&#x000A;      this._getWindowBorderSize();&#x000A;    var div = document.createElement(&quot;div&quot;);&#x000A;    div.className = &quot;wired_frame &quot; + this.options.className + &quot;_wired_frame&quot;;&#x000A;&#x000A;    div.style.position = 'absolute';&#x000A;    this.options.parent.insertBefore(div, this.options.parent.firstChild);&#x000A;    this.wiredElement = $(div);&#x000A;  }&#x000A;  if (this.useLeft)&#x000A;    this.wiredElement.setStyle({left: this.element.getStyle('left')});&#x000A;  else&#x000A;    this.wiredElement.setStyle({right: this.element.getStyle('right')});&#x000A;&#x000A;  if (this.useTop)&#x000A;    this.wiredElement.setStyle({top: this.element.getStyle('top')});&#x000A;  else&#x000A;    this.wiredElement.setStyle({bottom: this.element.getStyle('bottom')});&#x000A;&#x000A;  var dim = this.element.getDimensions();&#x000A;  this.wiredElement.setStyle({width: dim.width + &quot;px&quot;, height: dim.height +&quot;px&quot;});&#x000A;&#x000A;  this.wiredElement.setStyle({zIndex: Windows.maxZIndex+30});&#x000A;  return this.wiredElement;&#x000A;},&#x000A;&#x000A;_hideWiredElement: function() {&#x000A;  if (! this.wiredElement || ! this.currentDrag)&#x000A;    return;&#x000A;  if (this.currentDrag == this.element)&#x000A;    this.currentDrag = null;&#x000A;  else {&#x000A;    if (this.useLeft)&#x000A;      this.element.setStyle({left: this.currentDrag.getStyle('left')});&#x000A;    else&#x000A;      this.element.setStyle({right: this.currentDrag.getStyle('right')});&#x000A;&#x000A;    if (this.useTop)&#x000A;      this.element.setStyle({top: this.currentDrag.getStyle('top')});&#x000A;    else&#x000A;      this.element.setStyle({bottom: this.currentDrag.getStyle('bottom')});&#x000A;&#x000A;    this.currentDrag.hide();&#x000A;    this.currentDrag = null;&#x000A;    if (this.doResize)&#x000A;      this.setSize(this.width, this.height);&#x000A;  }&#x000A;},&#x000A;&#x000A;_notify: function(eventName) {&#x000A;  if (this.options[eventName])&#x000A;    this.options[eventName](this);&#x000A;  else&#x000A;    Windows.notify(eventName, this);&#x000A;}</pre>
            <p>
            };
            </p>
            <p>
            // Windows containers, register all page windows var Windows = {
            </p>
            <pre>windows: new Hash(),&#x000A;windowsByName: new Hash(),&#x000A;modalWindows: [],&#x000A;observers: [],&#x000A;focusedWindow: null,&#x000A;maxZIndex: 0,&#x000A;overlayShowEffectOptions: {duration: 0.5},&#x000A;overlayHideEffectOptions: {duration: 0.5},&#x000A;&#x000A;addObserver: function(observer) {&#x000A;  this.removeObserver(observer);&#x000A;  this.observers.push(observer);&#x000A;},&#x000A;&#x000A;removeObserver: function(observer) {&#x000A;  this.observers = this.observers.reject( function(o) { return o==observer });&#x000A;},&#x000A;&#x000A;// onDestroy onStartResize onStartMove onResize onMove onEndResize onEndMove onFocus onBlur onBeforeShow onShow onHide onMinimize onMaximize onClose&#x000A;notify: function(eventName, win) {&#x000A;  this.observers.each( function(o) {if(o[eventName]) o[eventName](eventName, win);});&#x000A;},&#x000A;&#x000A;// Gets window from its id&#x000A;getWindow: function(id) {&#x000A;  return this.windows.get(id);&#x000A;},&#x000A;&#x000A;// Gets the last focused window&#x000A;getFocusedWindow: function() {&#x000A;  return this.focusedWindow;&#x000A;},&#x000A;&#x000A;updateFocusedWindow: function() {&#x000A;  this.focusedWindow = this.windows.values().length &gt;=2 ? this.windows.values()[this.windows.values().length-2] : null;&#x000A;},&#x000A;&#x000A;// Add a modal window in the stack&#x000A;addModalWindow: function(win) {&#x000A;  // Disable screen if first modal window&#x000A;  if (this.modalWindows.length == 0) {&#x000A;    WindowUtilities.disableScreen(win.options.className, 'overlay_modal', win.overlayOpacity, win.getId(), win.options.parent);&#x000A;  }&#x000A;  else {&#x000A;    // Move overlay over all windows&#x000A;    if (Window.keepMultiModalWindow) {&#x000A;      $('overlay_modal').style.zIndex = Windows.maxZIndex + 1;&#x000A;      Windows.maxZIndex += 1;&#x000A;      WindowUtilities._hideSelect(this.modalWindows.last().getId());&#x000A;    }&#x000A;    // Hide current modal window&#x000A;    else&#x000A;      this.modalWindows.last().element.hide();&#x000A;    // Fucking IE select issue&#x000A;    WindowUtilities._showSelect(win.getId());&#x000A;  }&#x000A;  this.modalWindows.push(win);&#x000A;},&#x000A;&#x000A;removeModalWindow: function(win) {&#x000A;  this.modalWindows.pop();&#x000A;&#x000A;  // No more modal windows&#x000A;  if (this.modalWindows.length == 0)&#x000A;    WindowUtilities.enableScreen();&#x000A;  else {&#x000A;    if (Window.keepMultiModalWindow) {&#x000A;      this.modalWindows.last().toFront();&#x000A;      WindowUtilities._showSelect(this.modalWindows.last().getId());&#x000A;    }&#x000A;    else&#x000A;      this.modalWindows.last().element.show();&#x000A;  }&#x000A;},&#x000A;&#x000A;registerByName: function(name, win) {&#x000A;  this.windowsByName.set(name, win);&#x000A;},&#x000A;&#x000A;unregisterByName: function(name) {&#x000A;  this.windowsByName.unset(name);&#x000A;},&#x000A;&#x000A;removeWindowFromByName: function(win) {&#x000A;  key = this.findNameFromWindow(win);&#x000A;  if(key) {&#x000A;    this.unregisterByName(key);&#x000A;  }&#x000A;},&#x000A;&#x000A;findNameFromWindow: function(win) {&#x000A;  return this.windowsByName.collect(function(e){ return e.last() == win ? e.first() : null; }).compact().first();&#x000A;},&#x000A;&#x000A;closeByName: function(name) {&#x000A;  if(this.windowsByName.get(name)) {&#x000A;    this.windowsByName.get(name).close();&#x000A;  }&#x000A;},&#x000A;&#x000A;existsByName: function(name) {&#x000A;  return this.windowsByName.get(name) ? true : false;&#x000A;},&#x000A;&#x000A;getWindowByName: function(name) {&#x000A;  return this.windowsByName.get(name);&#x000A;},&#x000A;&#x000A;// Registers a new window (called by Windows constructor)&#x000A;register: function(win) {&#x000A;  this.windows.set(win.getId(), win);&#x000A;},&#x000A;&#x000A;// Unregisters a window (called by Windows destructor)&#x000A;unregister: function(win) {&#x000A;  this.windows.unset(win.getId());&#x000A;  this.removeWindowFromByName(win);&#x000A;},&#x000A;&#x000A;// Closes all windows&#x000A;closeAll: function() {&#x000A;  this.windows.values().each( function(w) {Windows.close(w.getId())} );&#x000A;},&#x000A;&#x000A;closeAllModalWindows: function() {&#x000A;  WindowUtilities.enableScreen();&#x000A;  this.modalWindows.each( function(win) {if (win) win.close()});&#x000A;},&#x000A;&#x000A;// Minimizes a window with its id&#x000A;minimize: function(id, event) {&#x000A;  var win = this.getWindow(id)&#x000A;  if (win &amp;&amp; win.visible)&#x000A;    win.minimize();&#x000A;  Event.stop(event);&#x000A;},&#x000A;&#x000A;// Maximizes a window with its id&#x000A;maximize: function(id, event) {&#x000A;  var win = this.getWindow(id)&#x000A;  if (win &amp;&amp; win.visible)&#x000A;    win.maximize();&#x000A;  Event.stop(event);&#x000A;},&#x000A;&#x000A;// Closes a window with its id&#x000A;close: function(id, event) {&#x000A;  var win = this.getWindow(id);&#x000A;  if (win)&#x000A;    win.close();&#x000A;  if (event)&#x000A;    Event.stop(event);&#x000A;},&#x000A;&#x000A;blur: function(id) {&#x000A;  var win = this.getWindow(id);&#x000A;  if (!win)&#x000A;    return;&#x000A;  if (win.options.blurClassName)&#x000A;    win.changeClassName(win.options.blurClassName);&#x000A;  if (this.focusedWindow == win)&#x000A;    this.focusedWindow = null;&#x000A;  win._notify(&quot;onBlur&quot;);&#x000A;},&#x000A;&#x000A;focus: function(id) {&#x000A;  var win = this.getWindow(id);&#x000A;  if (!win)&#x000A;    return;&#x000A;  if (this.focusedWindow)&#x000A;    this.blur(this.focusedWindow.getId())&#x000A;&#x000A;  if (win.options.focusClassName)&#x000A;    win.changeClassName(win.options.focusClassName);&#x000A;  this.focusedWindow = win;&#x000A;  win._notify(&quot;onFocus&quot;);&#x000A;},&#x000A;&#x000A;unsetOverflow: function(except) {&#x000A;  this.windows.values().each(function(d) { d.oldOverflow = d.getContent().getStyle(&quot;overflow&quot;) || &quot;auto&quot; ; d.getContent().setStyle({overflow: &quot;hidden&quot;}) });&#x000A;  if (except &amp;&amp; except.oldOverflow)&#x000A;    except.getContent().setStyle({overflow: except.oldOverflow});&#x000A;},&#x000A;&#x000A;resetOverflow: function() {&#x000A;  this.windows.values().each(function(d) { if (d.oldOverflow) d.getContent().setStyle({overflow: d.oldOverflow}) });&#x000A;},&#x000A;&#x000A;updateZindex: function(zindex, win) {&#x000A;  if (zindex &gt; this.maxZIndex) {&#x000A;    this.maxZIndex = zindex;&#x000A;    if (this.focusedWindow)&#x000A;      this.blur(this.focusedWindow.getId())&#x000A;  }&#x000A;  this.focusedWindow = win;&#x000A;  if (this.focusedWindow)&#x000A;    this.focus(this.focusedWindow.getId())&#x000A;}</pre>
            <p>
            };
            </p>
            <p>
            var Dialog = {
            </p>
            <pre>dialogId: null,&#x000A;onCompleteFunc: null,&#x000A;callFunc: null,&#x000A;parameters: null,&#x000A;&#x000A;confirm: function(content, parameters) {&#x000A;  // Get Ajax return before&#x000A;  if (content &amp;&amp; typeof content != &quot;string&quot;) {&#x000A;    Dialog._runAjaxRequest(content, parameters, Dialog.confirm);&#x000A;    return&#x000A;  }&#x000A;  content = content || &quot;&quot;;&#x000A;&#x000A;  parameters = parameters || {};&#x000A;  var okLabel = parameters.okLabel ? parameters.okLabel : &quot;Ok&quot;;&#x000A;  var cancelLabel = parameters.cancelLabel ? parameters.cancelLabel : &quot;Cancel&quot;;&#x000A;&#x000A;  // Backward compatibility&#x000A;  parameters = Object.extend(parameters, parameters.windowParameters || {});&#x000A;  parameters.windowParameters = parameters.windowParameters || {};&#x000A;&#x000A;  parameters.className = parameters.className || &quot;alert&quot;;&#x000A;&#x000A;  var okButtonClass = &quot;class ='&quot; + (parameters.buttonClass ? parameters.buttonClass + &quot; &quot; : &quot;&quot;) + &quot; ok_button'&quot;&#x000A;  var cancelButtonClass = &quot;class ='&quot; + (parameters.buttonClass ? parameters.buttonClass + &quot; &quot; : &quot;&quot;) + &quot; cancel_button'&quot;&#x000A;  var content = &quot;\&#x000A;    &lt;div class='&quot; + parameters.className + &quot;_message'&gt;&quot; + content  + &quot;&lt;/div&gt;\&#x000A;      &lt;div class='&quot; + parameters.className + &quot;_buttons'&gt;\&#x000A;        &lt;input type='button' value='&quot; + okLabel + &quot;' onclick='Dialog.okCallback()' &quot; + okButtonClass + &quot;/&gt;\&#x000A;        &lt;input type='button' value='&quot; + cancelLabel + &quot;' onclick='Dialog.cancelCallback()' &quot; + cancelButtonClass + &quot;/&gt;\&#x000A;      &lt;/div&gt;\&#x000A;  &quot;;&#x000A;  return this._openDialog(content, parameters)&#x000A;},&#x000A;&#x000A;alert: function(content, parameters) {&#x000A;  // Get Ajax return before&#x000A;  if (content &amp;&amp; typeof content != &quot;string&quot;) {&#x000A;    Dialog._runAjaxRequest(content, parameters, Dialog.alert);&#x000A;    return&#x000A;  }&#x000A;  content = content || &quot;&quot;;&#x000A;&#x000A;  parameters = parameters || {};&#x000A;  var okLabel = parameters.okLabel ? parameters.okLabel : &quot;Ok&quot;;&#x000A;&#x000A;  // Backward compatibility&#x000A;  parameters = Object.extend(parameters, parameters.windowParameters || {});&#x000A;  parameters.windowParameters = parameters.windowParameters || {};&#x000A;&#x000A;  parameters.className = parameters.className || &quot;alert&quot;;&#x000A;&#x000A;  var okButtonClass = &quot;class ='&quot; + (parameters.buttonClass ? parameters.buttonClass + &quot; &quot; : &quot;&quot;) + &quot; ok_button'&quot;&#x000A;  var content = &quot;\&#x000A;    &lt;div class='&quot; + parameters.className + &quot;_message'&gt;&quot; + content  + &quot;&lt;/div&gt;\&#x000A;      &lt;div class='&quot; + parameters.className + &quot;_buttons'&gt;\&#x000A;        &lt;input type='button' value='&quot; + okLabel + &quot;' onclick='Dialog.okCallback()' &quot; + okButtonClass + &quot;/&gt;\&#x000A;      &lt;/div&gt;&quot;;&#x000A;  return this._openDialog(content, parameters)&#x000A;},&#x000A;&#x000A;info: function(content, parameters) {&#x000A;  // Get Ajax return before&#x000A;  if (content &amp;&amp; typeof content != &quot;string&quot;) {&#x000A;    Dialog._runAjaxRequest(content, parameters, Dialog.info);&#x000A;    return&#x000A;  }&#x000A;  content = content || &quot;&quot;;&#x000A;&#x000A;  // Backward compatibility&#x000A;  parameters = parameters || {};&#x000A;  parameters = Object.extend(parameters, parameters.windowParameters || {});&#x000A;  parameters.windowParameters = parameters.windowParameters || {};&#x000A;&#x000A;  parameters.className = parameters.className || &quot;alert&quot;;&#x000A;&#x000A;  var content = &quot;&lt;div id='modal_dialog_message' class='&quot; + parameters.className + &quot;_message'&gt;&quot; + content  + &quot;&lt;/div&gt;&quot;;&#x000A;  if (parameters.showProgress)&#x000A;    content += &quot;&lt;div id='modal_dialog_progress' class='&quot; + parameters.className + &quot;_progress'&gt;  &lt;/div&gt;&quot;;&#x000A;&#x000A;  parameters.ok = null;&#x000A;  parameters.cancel = null;&#x000A;&#x000A;  return this._openDialog(content, parameters)&#x000A;},&#x000A;&#x000A;setInfoMessage: function(message) {&#x000A;  $('modal_dialog_message').update(message);&#x000A;},&#x000A;&#x000A;closeInfo: function() {&#x000A;  Windows.close(this.dialogId);&#x000A;},&#x000A;&#x000A;_openDialog: function(content, parameters) {&#x000A;  var className = parameters.className;&#x000A;&#x000A;  if (! parameters.height &amp;&amp; ! parameters.width) {&#x000A;    parameters.width = WindowUtilities.getPageSize(parameters.options.parent || document.body).pageWidth / 2;&#x000A;  }&#x000A;  if (parameters.id)&#x000A;    this.dialogId = parameters.id;&#x000A;  else {&#x000A;    var t = new Date();&#x000A;    this.dialogId = 'modal_dialog_' + t.getTime();&#x000A;    parameters.id = this.dialogId;&#x000A;  }&#x000A;&#x000A;  // compute height or width if need be&#x000A;  if (! parameters.height || ! parameters.width) {&#x000A;    var size = WindowUtilities._computeSize(content, this.dialogId, parameters.width, parameters.height, 5, className)&#x000A;    if (parameters.height)&#x000A;      parameters.width = size + 5&#x000A;    else&#x000A;      parameters.height = size + 5&#x000A;  }&#x000A;  parameters.effectOptions = parameters.effectOptions ;&#x000A;  parameters.resizable   = parameters.resizable || false;&#x000A;  parameters.minimizable = parameters.minimizable || false;&#x000A;  parameters.maximizable = parameters.maximizable ||  false;&#x000A;  parameters.draggable   = parameters.draggable || false;&#x000A;  parameters.closable    = parameters.closable || false;&#x000A;&#x000A;  var win = new Window(parameters);&#x000A;  win.getContent().innerHTML = content;&#x000A;&#x000A;  win.showCenter(true, parameters.top, parameters.left);&#x000A;  win.setDestroyOnClose();&#x000A;&#x000A;  win.cancelCallback = parameters.onCancel || parameters.cancel;&#x000A;  win.okCallback = parameters.onOk || parameters.ok;&#x000A;&#x000A;  return win;&#x000A;},&#x000A;&#x000A;_getAjaxContent: function(originalRequest)  {&#x000A;    Dialog.callFunc(originalRequest.responseText, Dialog.parameters)&#x000A;},&#x000A;&#x000A;_runAjaxRequest: function(message, parameters, callFunc) {&#x000A;  if (message.options == null)&#x000A;    message.options = {}&#x000A;  Dialog.onCompleteFunc = message.options.onComplete;&#x000A;  Dialog.parameters = parameters;&#x000A;  Dialog.callFunc = callFunc;&#x000A;&#x000A;  message.options.onComplete = Dialog._getAjaxContent;&#x000A;  new Ajax.Request(message.url, message.options);&#x000A;},&#x000A;&#x000A;okCallback: function() {&#x000A;  var win = Windows.focusedWindow;&#x000A;  if (!win.okCallback || win.okCallback(win)) {&#x000A;    // Remove onclick on button&#x000A;    $$(&quot;#&quot; + win.getId()+&quot; input&quot;).each(function(element) {element.onclick=null;})&#x000A;    win.close();&#x000A;  }&#x000A;},&#x000A;&#x000A;cancelCallback: function() {&#x000A;  var win = Windows.focusedWindow;&#x000A;  // Remove onclick on button&#x000A;  $$(&quot;#&quot; + win.getId()+&quot; input&quot;).each(function(element) {element.onclick=null})&#x000A;  win.close();&#x000A;  if (win.cancelCallback)&#x000A;    win.cancelCallback(win);&#x000A;}</pre>
            <p>
            } /*
            </p>
            <pre>Based on Lightbox JS: Fullsize Image Overlays&#x000A;by Lokesh Dhakar - http://www.huddletogether.com&#x000A;&#x000A;For more information on this script, visit:&#x000A;http://huddletogether.com/projects/lightbox/&#x000A;&#x000A;Licensed under the Creative Commons Attribution 2.5 License - http://creativecommons.org/licenses/by/2.5/&#x000A;(basically, do anything you want, just leave my name and link)</pre>
            <p>
            */
            </p>
            <p>
            if (Prototype.Browser.WebKit) {
            </p>
            <pre>var array = navigator.userAgent.match(new RegExp(/AppleWebKit\/([\d\.\+]*)/));&#x000A;Prototype.Browser.WebKitVersion = parseFloat(array[1]);</pre>
            <p>
            }
            </p>
            <p>
            var WindowUtilities = {
            </p>
            <pre>// From dragdrop.js&#x000A;getWindowScroll: function(parent) {&#x000A;  var T, L, W, H;&#x000A;  parent = parent || document.body;&#x000A;  if (parent != document.body) {&#x000A;    T = parent.scrollTop;&#x000A;    L = parent.scrollLeft;&#x000A;    W = parent.scrollWidth;&#x000A;    H = parent.scrollHeight;&#x000A;  }&#x000A;  else {&#x000A;    var w = window;&#x000A;    with (w.document) {&#x000A;      if (w.document.documentElement &amp;&amp; documentElement.scrollTop) {&#x000A;        T = documentElement.scrollTop;&#x000A;        L = documentElement.scrollLeft;&#x000A;      } else if (w.document.body) {&#x000A;        T = body.scrollTop;&#x000A;        L = body.scrollLeft;&#x000A;      }&#x000A;      if (w.innerWidth) {&#x000A;        W = w.innerWidth;&#x000A;        H = w.innerHeight;&#x000A;      } else if (w.document.documentElement &amp;&amp; documentElement.clientWidth) {&#x000A;        W = documentElement.clientWidth;&#x000A;        H = documentElement.clientHeight;&#x000A;      } else {&#x000A;        W = body.offsetWidth;&#x000A;        H = body.offsetHeight&#x000A;      }&#x000A;    }&#x000A;  }&#x000A;  return { top: T, left: L, width: W, height: H };&#x000A;},&#x000A;//&#x000A;// getPageSize()&#x000A;// Returns array with page width, height and window width, height&#x000A;// Core code from - quirksmode.org&#x000A;// Edit for Firefox by pHaez&#x000A;//&#x000A;getPageSize: function(parent){&#x000A;  parent = parent || document.body;&#x000A;  var windowWidth, windowHeight;&#x000A;  var pageHeight, pageWidth;&#x000A;  if (parent != document.body) {&#x000A;    windowWidth = parent.getWidth();&#x000A;    windowHeight = parent.getHeight();&#x000A;    pageWidth = parent.scrollWidth;&#x000A;    pageHeight = parent.scrollHeight;&#x000A;  }&#x000A;  else {&#x000A;    var xScroll, yScroll;&#x000A;&#x000A;    if (window.innerHeight &amp;&amp; window.scrollMaxY) {&#x000A;      xScroll = document.body.scrollWidth;&#x000A;      yScroll = window.innerHeight + window.scrollMaxY;&#x000A;    } else if (document.body.scrollHeight &gt; document.body.offsetHeight){ // all but Explorer Mac&#x000A;      xScroll = document.body.scrollWidth;&#x000A;      yScroll = document.body.scrollHeight;&#x000A;    } else { // Explorer Mac...would also work in Explorer 6 Strict, Mozilla and Safari&#x000A;      xScroll = document.body.offsetWidth;&#x000A;      yScroll = document.body.offsetHeight;&#x000A;    }&#x000A;&#x000A;    if (self.innerHeight) {  // all except Explorer&#x000A;      windowWidth = self.innerWidth;&#x000A;      windowHeight = self.innerHeight;&#x000A;    } else if (document.documentElement &amp;&amp; document.documentElement.clientHeight) { // Explorer 6 Strict Mode&#x000A;      windowWidth = document.documentElement.clientWidth;&#x000A;      windowHeight = document.documentElement.clientHeight;&#x000A;    } else if (document.body) { // other Explorers&#x000A;      windowWidth = document.body.clientWidth;&#x000A;      windowHeight = document.body.clientHeight;&#x000A;    }&#x000A;&#x000A;    // for small pages with total height less then height of the viewport&#x000A;    if(yScroll &lt; windowHeight){&#x000A;      pageHeight = windowHeight;&#x000A;    } else {&#x000A;      pageHeight = yScroll;&#x000A;    }&#x000A;&#x000A;    // for small pages with total width less then width of the viewport&#x000A;    if(xScroll &lt; windowWidth){&#x000A;      pageWidth = windowWidth;&#x000A;    } else {&#x000A;      pageWidth = xScroll;&#x000A;    }&#x000A;  }&#x000A;  return {pageWidth: pageWidth ,pageHeight: pageHeight , windowWidth: windowWidth, windowHeight: windowHeight};&#x000A;},&#x000A;&#x000A;disableScreen: function(className, overlayId, overlayOpacity, contentId, parent) {&#x000A;  WindowUtilities.initLightbox(overlayId, className, function() {this._disableScreen(className, overlayId, overlayOpacity, contentId)}.bind(this), parent || document.body);&#x000A;},&#x000A;&#x000A;_disableScreen: function(className, overlayId, overlayOpacity, contentId) {&#x000A;  // prep objects&#x000A;  var objOverlay = $(overlayId);&#x000A;&#x000A;  var pageSize = WindowUtilities.getPageSize(objOverlay.parentNode);&#x000A;&#x000A;  // Hide select boxes as they will 'peek' through the image in IE, store old value&#x000A;  if (contentId &amp;&amp; Prototype.Browser.IE) {&#x000A;    WindowUtilities._hideSelect();&#x000A;    WindowUtilities._showSelect(contentId);&#x000A;  }&#x000A;&#x000A;  // set height of Overlay to take up whole page and show&#x000A;  objOverlay.style.height = (pageSize.pageHeight + 'px');&#x000A;  objOverlay.style.display = 'none';&#x000A;  if (overlayId == &quot;overlay_modal&quot; &amp;&amp; Window.hasEffectLib &amp;&amp; Windows.overlayShowEffectOptions) {&#x000A;    objOverlay.overlayOpacity = overlayOpacity;&#x000A;    new Effect.Appear(objOverlay, Object.extend({from: 0, to: overlayOpacity}, Windows.overlayShowEffectOptions));&#x000A;  }&#x000A;  else&#x000A;    objOverlay.style.display = &quot;block&quot;;&#x000A;},&#x000A;&#x000A;enableScreen: function(id) {&#x000A;  id = id || 'overlay_modal';&#x000A;  var objOverlay =  $(id);&#x000A;  if (objOverlay) {&#x000A;    // hide lightbox and overlay&#x000A;    if (id == &quot;overlay_modal&quot; &amp;&amp; Window.hasEffectLib &amp;&amp; Windows.overlayHideEffectOptions)&#x000A;      new Effect.Fade(objOverlay, Object.extend({from: objOverlay.overlayOpacity, to:0}, Windows.overlayHideEffectOptions));&#x000A;    else {&#x000A;      objOverlay.style.display = 'none';&#x000A;      objOverlay.parentNode.removeChild(objOverlay);&#x000A;    }&#x000A;&#x000A;    // make select boxes visible using old value&#x000A;    if (id != &quot;__invisible__&quot;)&#x000A;      WindowUtilities._showSelect();&#x000A;  }&#x000A;},&#x000A;&#x000A;_hideSelect: function(id) {&#x000A;  if (Prototype.Browser.IE) {&#x000A;    id = id ==  null ? &quot;&quot; : &quot;#&quot; + id + &quot; &quot;;&#x000A;    $$(id + 'select').each(function(element) {&#x000A;      if (! WindowUtilities.isDefined(element.oldVisibility)) {&#x000A;        element.oldVisibility = element.style.visibility ? element.style.visibility : &quot;visible&quot;;&#x000A;        element.style.visibility = &quot;hidden&quot;;&#x000A;      }&#x000A;    });&#x000A;  }&#x000A;},&#x000A;&#x000A;_showSelect: function(id) {&#x000A;  if (Prototype.Browser.IE) {&#x000A;    id = id ==  null ? &quot;&quot; : &quot;#&quot; + id + &quot; &quot;;&#x000A;    $$(id + 'select').each(function(element) {&#x000A;      if (WindowUtilities.isDefined(element.oldVisibility)) {&#x000A;        // Why?? Ask IE&#x000A;        try {&#x000A;          element.style.visibility = element.oldVisibility;&#x000A;        } catch(e) {&#x000A;          element.style.visibility = &quot;visible&quot;;&#x000A;        }&#x000A;        element.oldVisibility = null;&#x000A;      }&#x000A;      else {&#x000A;        if (element.style.visibility)&#x000A;          element.style.visibility = &quot;visible&quot;;&#x000A;      }&#x000A;    });&#x000A;  }&#x000A;},&#x000A;&#x000A;isDefined: function(object) {&#x000A;  return typeof(object) != &quot;undefined&quot; &amp;&amp; object != null;&#x000A;},&#x000A;&#x000A;// initLightbox()&#x000A;// Function runs on window load, going through link tags looking for rel=&quot;lightbox&quot;.&#x000A;// These links receive onclick events that enable the lightbox display for their targets.&#x000A;// The function also inserts html markup at the top of the page which will be used as a&#x000A;// container for the overlay pattern and the inline image.&#x000A;initLightbox: function(id, className, doneHandler, parent) {&#x000A;  // Already done, just update zIndex&#x000A;  if ($(id)) {&#x000A;    Element.setStyle(id, {zIndex: Windows.maxZIndex + 1});&#x000A;    Windows.maxZIndex++;&#x000A;    doneHandler();&#x000A;  }&#x000A;  // create overlay div and hardcode some functional styles (aesthetic styles are in CSS file)&#x000A;  else {&#x000A;    var objOverlay = document.createElement(&quot;div&quot;);&#x000A;    objOverlay.setAttribute('id', id);&#x000A;    objOverlay.className = &quot;overlay_&quot; + className&#x000A;    objOverlay.style.display = 'none';&#x000A;    objOverlay.style.position = 'absolute';&#x000A;    objOverlay.style.top = '0';&#x000A;    objOverlay.style.left = '0';&#x000A;    objOverlay.style.zIndex = Windows.maxZIndex + 1;&#x000A;    Windows.maxZIndex++;&#x000A;    objOverlay.style.width = '100%';&#x000A;    parent.insertBefore(objOverlay, parent.firstChild);&#x000A;    if (Prototype.Browser.WebKit &amp;&amp; id == &quot;overlay_modal&quot;) {&#x000A;      setTimeout(function() {doneHandler()}, 10);&#x000A;    }&#x000A;    else&#x000A;      doneHandler();&#x000A;  }&#x000A;},&#x000A;&#x000A;setCookie: function(value, parameters) {&#x000A;  document.cookie= parameters[0] + &quot;=&quot; + escape(value) +&#x000A;    ((parameters[1]) ? &quot;; expires=&quot; + parameters[1].toGMTString() : &quot;&quot;) +&#x000A;    ((parameters[2]) ? &quot;; path=&quot; + parameters[2] : &quot;&quot;) +&#x000A;    ((parameters[3]) ? &quot;; domain=&quot; + parameters[3] : &quot;&quot;) +&#x000A;    ((parameters[4]) ? &quot;; secure&quot; : &quot;&quot;);&#x000A;},&#x000A;&#x000A;getCookie: function(name) {&#x000A;  var dc = document.cookie;&#x000A;  var prefix = name + &quot;=&quot;;&#x000A;  var begin = dc.indexOf(&quot;; &quot; + prefix);&#x000A;  if (begin == -1) {&#x000A;    begin = dc.indexOf(prefix);&#x000A;    if (begin != 0) return null;&#x000A;  } else {&#x000A;    begin += 2;&#x000A;  }&#x000A;  var end = document.cookie.indexOf(&quot;;&quot;, begin);&#x000A;  if (end == -1) {&#x000A;    end = dc.length;&#x000A;  }&#x000A;  return unescape(dc.substring(begin + prefix.length, end));&#x000A;},&#x000A;&#x000A;_computeSize: function(content, id, width, height, margin, className) {&#x000A;  var objBody = document.body;&#x000A;  var tmpObj = document.createElement(&quot;div&quot;);&#x000A;  tmpObj.setAttribute('id', id);&#x000A;  tmpObj.className = className + &quot;_content&quot;;&#x000A;&#x000A;  if (height)&#x000A;    tmpObj.style.height = height + &quot;px&quot;&#x000A;  else&#x000A;    tmpObj.style.width = width + &quot;px&quot;&#x000A;&#x000A;  tmpObj.style.position = 'absolute';&#x000A;  tmpObj.style.top = '0';&#x000A;  tmpObj.style.left = '0';&#x000A;  tmpObj.style.display = 'none';&#x000A;&#x000A;  tmpObj.innerHTML = content;&#x000A;  objBody.insertBefore(tmpObj, objBody.firstChild);&#x000A;&#x000A;  var size;&#x000A;  if (height)&#x000A;    size = $(tmpObj).getDimensions().width + margin;&#x000A;  else&#x000A;    size = $(tmpObj).getDimensions().height + margin;&#x000A;  objBody.removeChild(tmpObj);&#x000A;  return size;&#x000A;}</pre>
            <p>
            }
            </p>
          </div>
          <div id='section'>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
